{"version":3,"sources":["status-collector.ts"],"names":[],"mappings":"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","file":"status-collector.js","sourceRoot":"","sourcesContent":["import {Inject, Injectable, Optional} from \"@angular/core\";\nimport {Observable} from \"rxjs/Observable\";\nimport {isArray} from \"rxjs/util/isArray\";\nimport {RikeTarget} from \"./rike\";\nimport {RikeEvent, RikeEventSource} from \"./event\";\nimport {Subscription} from \"rxjs/Subscription\";\n\n/**\n * Rike operation status labels.\n *\n * Each field corresponds to particular status. The value of this field could be either label, or function returning\n * label, accepting Rike operations target as the only argument.\n *\n * When the label is absent the corresponding status won't be displayed.\n *\n * @param <L> a type of status labels.\n */\nexport interface StatusLabels<L> {\n\n    /**\n     * Processing label. It is applied when operation is initiated, but not completed yet.\n     */\n    processing?: L | ((target: RikeTarget<any, any>) => L);\n\n    /**\n     * Failure label. It is applied when operation failed due to error.\n     */\n    failed?: L | ((target: RikeTarget<any, any>) => L);\n\n    /**\n     * Cancellation label. It is applied when operation is cancelled.\n     */\n    cancelled?: L | ((target: RikeTarget<any, any>) => L);\n\n    /**\n     * Success label. It is applied when operation succeed.\n     */\n    succeed?: L | ((target: RikeTarget<any, any>) => L);\n\n}\n\n/**\n * A map of Rike operations status labels.\n *\n * Each key corresponds to particular operation name, and it value is status labels to apply to this operation.\n *\n * If labels for the given operation is not specified, or the is no label for the operation status, the label will be\n * searched under the `\"*\"` key.\n *\n * @param <L> a type of status labels.\n */\nexport interface StatusLabelMap<L> {\n    [operation: string]: StatusLabels<L>;\n}\n\n/**\n * Default status label.\n */\nexport type DefaultStatusLabel = string | {\n\n    /**\n     * Status identifier.\n     */\n    id?: string;\n\n    /**\n     * Status message.\n     */\n    message: string;\n\n    /**\n     * CSS class to indicate this status.\n     */\n    cssClass?: string;\n\n}\n\n/**\n * Default map of Rike operations status labels.\n *\n * Default status labels are strings.\n */\nexport const DEFAULT_STATUS_LABELS: StatusLabelMap<DefaultStatusLabel> = {\n    \"*\": {\n        processing: {\n            id: \"processing\",\n            message: \"Processing\"\n        },\n        failed: {\n            id: \"failed\",\n            message: \"Error\"\n        },\n        cancelled: {\n            id: \"cancelled\",\n            message: \"Cancelled\"\n        }\n    },\n    \"load\": {\n        processing: {\n            id: \"loading\",\n            message: \"Loading\",\n        },\n    },\n    \"send\": {\n        processing: {\n            id: \"sending\",\n            message: \"Sending\"\n        },\n        succeed: {\n            id: \"sent\",\n            message: \"Sent\"\n        },\n    },\n    \"read\": {\n        processing: {\n            id: \"loading\",\n            message: \"Loading\"\n        },\n    },\n    \"create\": {\n        processing: {\n            id: \"creating\",\n            message: \"Creating\"\n        },\n        succeed: {\n            id: \"created\",\n            message: \"Created\"\n        },\n    },\n    \"update\": {\n        processing: {\n            id: \"updating\",\n            message: \"Updating\"\n        },\n        succeed: {\n            id: \"updated\",\n            message: \"Updated\"\n        }\n    },\n    \"delete\": {\n        processing: {\n            id: \"deleting\",\n            message: \"Deleting\"\n        },\n        succeed: {\n            id: \"deleted\",\n            message: \"Deleted\"\n        },\n    },\n};\n\n/**\n * Rike operations status collecting service.\n *\n * It collects statuses of all available [Rike event sources][RikeEventSource].\n *\n * This service is registered automatically along with every event source by `provideEventSource()` method.\n * But unlike event sources it is not a multi-provider.\n *\n * An instance of this class could be created on its own. Then it is necessary to subscribe it on Rike events with\n * `subscribeOn` method.\n *\n * It is possible to read statuses and string labels from the service itself. Alternatively a view can be created\n * to read labels of arbitrary type.\n */\n\nexport class StatusCollector {\n\n    private _views: {[id: string]: StatusViewImpl<any>} = {};\n    private _targetStatuses: {[targetId: string]: TargetStatus} = {};\n    private _defaultView?: StatusViewImpl<DefaultStatusLabel>;\n    private _viewIdSeq = 0;\n\n    constructor(  eventSources?: RikeEventSource[]) {\n        if (eventSources) {\n            for (let esrc of eventSources) {\n                this.subscribeOn(esrc.rikeEvents);\n            }\n        }\n    }\n\n    /**\n     * Current status labels.\n     *\n     * @return {DefaultStatusLabel[]} array of default labels.\n     */\n    get labels(): DefaultStatusLabel[] {\n        return this._defaultView ? this._defaultView.labels : [];\n    }\n\n    /**\n     * Whether some operation is in process.\n     */\n    get processing(): boolean {\n        return this._defaultView && this._defaultView.processing || false;\n    }\n\n    /**\n     * Whether some operation failed.\n     */\n    get failed(): boolean {\n        return this._defaultView && this._defaultView.failed || false;\n    }\n\n    /**\n     * Whether some operation cancelled.\n     */\n    get cancelled(): boolean {\n        return this._defaultView && this._defaultView.cancelled || false;\n    }\n\n    /**\n     * Whether some operation succeed.\n     */\n    get succeed(): boolean {\n        return this._defaultView && this._defaultView.succeed || false;\n    }\n\n    /**\n     * Subscribes this collector on the given Rike events emitter.\n     *\n     * @param events Rike events emitter to subscribe on.\n     */\n    subscribeOn(events: Observable<RikeEvent>): Subscription {\n        return events.subscribe((event: RikeEvent) => this.applyEvent(event));\n    }\n\n    /**\n     * Constructs a Rike operations status view.\n     *\n     * When the view is no longer needed a {{StatusView.close}} method should be called to release resources\n     * associated with it.\n     *\n     * @param <L> a type of status labels.\n     * @param labels a map(s) of Rike operations status labels to use by this view.\n     *\n     * @return {StatusView<L>} new status view.\n     */\n    view<L>(...labels: StatusLabelMap<L>[]): StatusView<L> {\n        return this.addView(\"\" + ++this._viewIdSeq, ...labels);\n    }\n\n    private addView<L>(id: string, ...labels: StatusLabelMap<L>[]): StatusViewImpl<L> {\n\n        const view = new StatusViewImpl<L>(this._views, this._targetStatuses, id).withLabels(...labels);\n\n        this._views[id] = view;\n\n        return view;\n    }\n\n    private applyEvent(event: RikeEvent) {\n        this.initDefaultView(event);\n        this.updateTargetStatuses(event);\n        this.resetViews();\n    }\n\n    private initDefaultView(event: RikeEvent) {\n        if (!this._defaultView) {\n\n            const defaultStatusLabels = event.target.rike.options.defaultStatusLabels;\n\n            if (isArray(defaultStatusLabels)) {\n                this._defaultView = this.addView(\"default\", ...defaultStatusLabels);\n            } else {\n                this._defaultView = this.addView(\"default\", defaultStatusLabels);\n            }\n        }\n    }\n\n    private updateTargetStatuses(event: RikeEvent) {\n\n        const uniqueId = event.target.uniqueId;\n\n        if (!event.complete) {\n            this._targetStatuses[uniqueId] = {\n                start: event,\n            }\n        } else {\n\n            const targetStatus = this._targetStatuses[uniqueId];\n\n            if (!targetStatus) {\n                this._targetStatuses[uniqueId] = {start: event, end: event};\n            } else {\n                targetStatus.end = event;\n            }\n        }\n    }\n\n    private resetViews() {\n        for (let id in this._views) {\n            if (this._views.hasOwnProperty(id)) {\n                this._views[id].reset();\n            }\n        }\n    }\n\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: Array, decorators: [{ type: Inject, args: [RikeEventSource, ] }, { type: Optional }, ]},\n];\n}\n\n/**\n * Rike operations status view.\n *\n * It could be created by {{StatusCollector.view}} and will be updated with new statuses until the `close()`\n * method call.\n *\n * @param <L> a type of status labels.\n */\nexport interface StatusView<L> {\n\n    /**\n     * Current status labels.\n     *\n     * @return {L[]} array of status labels.\n     */\n    readonly labels: L[];\n\n    /**\n     * Whether some operation is in process.\n     */\n    readonly processing: boolean;\n\n    /**\n     * Whether some operation failed.\n     */\n    readonly failed: boolean;\n\n    /**\n     * Whether some operation cancelled.\n     */\n    readonly cancelled: boolean\n\n    /**\n     * Whether some operation succeed.\n     */\n    readonly succeed: boolean;\n\n    /**\n     * Registers new operation status labels.\n     *\n     * @param labels a map of operation status labels.\n     */\n    withLabels(labels: StatusLabelMap<L>): this;\n\n    /**\n     * Registers new status labels for the given operation.\n     *\n     * @param operation target operation name.\n     * @param labels operation status labels.\n     */\n    withOperationLabels(operation: string, labels: StatusLabels<L>): this;\n\n    /**\n     * Closes the view.\n     *\n     * This method should be called when the view is no longer needed. After it is called the view won't be updated\n     * any more.\n     */\n    close(): void;\n\n}\n\nclass StatusViewImpl<L> implements StatusView<L> {\n\n    private _labels: StatusLabelMap<L>[] = [];\n    private _combined?: CombinedStatus<L>;\n\n    constructor(\n        private _views: {[id: string]: StatusViewImpl<any>},\n        private _targetStatuses: {[targetId: string]: TargetStatus},\n        private _id: string) {\n    }\n\n    get labels(): L[] {\n        return this.combined && this.combined.labels || [];\n    }\n\n    get processing(): boolean {\n        return this.combined && this.combined.processing || false;\n    }\n\n    get failed(): boolean {\n        return this.combined && this.combined.failed || false;\n    }\n\n    get cancelled(): boolean {\n        return this.combined && this.combined.cancelled || false;\n    }\n\n    get succeed(): boolean {\n        return this.combined && this.combined.succeed || false;\n    }\n\n    withLabels(...labels: StatusLabelMap<L>[]): this {\n        this._combined = undefined;\n        this._labels.unshift(...labels);\n        return this;\n    }\n\n    withOperationLabels(operation: string, ...labels: StatusLabels<L>[]): this {\n        this._combined = undefined;\n        for (let l of labels) {\n            this.withLabels({\n                [operation]: l\n            });\n        }\n        return this;\n    }\n\n    reset() {\n        this._combined = undefined;\n    }\n\n    close() {\n        delete this._views[this._id];\n    }\n\n    private get combined(): CombinedStatus<L> | undefined {\n        if (this._combined) {\n            return this._combined;\n        }\n\n        let combined: CombinedStatus<L> | undefined = undefined;\n\n        for (let targetId in this._targetStatuses) {\n            if (this._targetStatuses.hasOwnProperty(targetId)) {\n\n                const targetStatus: TargetStatus = this._targetStatuses[targetId]!;\n\n                if (!targetStatus) {\n                    continue;\n                }\n\n                combined = combineLabels(combined, this.labelFor(targetStatus));\n            }\n        }\n\n        return this._combined = combined;\n    }\n\n    private labelFor(status: TargetStatus): StatusLabel<L> | undefined {\n        return this.operationLabel(status.start.operation.name, status) || this.operationLabel(\"*\", status);\n    }\n\n    private operationLabel(operation: string, status: TargetStatus): StatusLabel<L> | undefined {\n        for (let l of this._labels) {\n\n            const label = labelOf(status, l[operation]);\n\n            if (label) {\n                return label;\n            }\n        }\n        return undefined;\n    }\n\n}\n\ninterface TargetStatus {\n    start: RikeEvent;\n    end?: RikeEvent;\n}\n\ninterface StatusLabel<L> {\n    label: L;\n    processing?: boolean;\n    failed?: boolean;\n    cancelled?: boolean;\n    succeed?: boolean;\n}\n\ninterface CombinedStatus<L> {\n    targets?: RikeTarget<any, any>;\n    labels: L[];\n    processing?: boolean;\n    failed?: boolean;\n    cancelled?: boolean;\n    succeed?: boolean;\n}\n\nfunction labelOf<L>(status: TargetStatus, labels?: StatusLabels<L>): StatusLabel<L> | undefined {\n    if (!labels) {\n        return undefined;\n    }\n\n    const end = status.end;\n\n    if (!end) {\n        const processing = evalLabel(status, labels.processing);\n        return processing && {label: processing, processing: true};\n    }\n    if (end.cancel) {\n        const cancelled = evalLabel(status, labels.cancelled);\n        return cancelled && {label: cancelled, cancelled: true};\n    }\n    if (end.error) {\n        const failed = evalLabel(status, labels.failed);\n        return failed && {label: failed, failed: true};\n    }\n\n    const succeed = evalLabel(status, labels.succeed);\n    return succeed && {label: succeed, succeed: true};\n}\n\nfunction evalLabel<L>(status: TargetStatus, label?: L | ((target: RikeTarget<any, any>) => L)): L | undefined {\n    if (!label) {\n        return undefined;\n    }\n    if (typeof label !== \"function\") {\n        return label;\n    }\n\n    const labelFn = label as ((target: RikeTarget<any, any>) => L);\n\n    return labelFn(status.start.target);\n}\n\nfunction combineLabels<L>(combined?: CombinedStatus<L>, label?: StatusLabel<L>): CombinedStatus<L> | undefined {\n    if (!label) {\n        return combined;\n    }\n\n    const lbl = label.label;\n\n    if (!combined) {\n        return {\n            labels: [lbl],\n            processing: label.processing,\n            failed: label.failed,\n            cancelled: label.cancelled,\n            succeed: label.succeed,\n        }\n    }\n\n    combined.processing = combined.processing || label.processing;\n    combined.failed = combined.failed || label.failed;\n    combined.cancelled = combined.cancelled || label.cancelled;\n    combined.succeed = combined.succeed || label.succeed;\n\n    for (let l of combined.labels) {\n        if (l === lbl) {\n            return combined;\n        }\n    }\n\n    combined.labels.push(lbl);\n\n    return combined;\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}